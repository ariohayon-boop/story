<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatBot Pro - ×“×©×‘×•×¨×“</title>
    
    <!-- Google Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- GSAP for animations -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    
    <!-- Lucide Icons -->
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#00D4AA',
                        'primary-dark': '#00A080',
                        secondary: '#0066FF',
                        dark: '#1A1A2E',
                        success: '#00E676',
                    },
                    fontFamily: {
                        heebo: ['Heebo', 'sans-serif'],
                    }
                }
            }
        }
    </script>
    
    <style>
        * {
            font-family: 'Heebo', sans-serif;
        }
        
        /* Glass Morphism */
        .glass {
            background: rgba(255, 255, 255, 0.7);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.3);
        }
        
        .glass-dark {
            background: rgba(26, 26, 46, 0.8);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        
        /* Gradient Background */
        .gradient-bg {
            background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%);
        }
        
        .gradient-primary {
            background: linear-gradient(135deg, #00D4AA 0%, #00A080 100%);
        }
        
        .gradient-secondary {
            background: linear-gradient(135deg, #0066FF 0%, #0052CC 100%);
        }
        
        /* Card hover effect */
        .card-hover {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }
        
        .card-hover:hover {
            transform: translateY(-4px);
            box-shadow: 0 12px 40px 0 rgba(31, 38, 135, 0.15);
        }
        
        /* Skeleton loader */
        .skeleton {
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: skeleton-loading 1.5s infinite;
        }
        
        @keyframes skeleton-loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }
        
        /* Ripple effect */
        .ripple {
            position: relative;
            overflow: hidden;
        }
        
        .ripple::after {
            content: '';
            position: absolute;
            top: 50%;
            left: 50%;
            width: 0;
            height: 0;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.3);
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        
        .ripple:active::after {
            width: 300px;
            height: 300px;
        }
        
        /* Sidebar */
        .sidebar {
            transition: all 0.3s ease;
        }
        
        .sidebar-item {
            transition: all 0.2s ease;
        }
        
        .sidebar-item:hover {
            background: rgba(0, 212, 170, 0.1);
        }
        
        .sidebar-item.active {
            background: rgba(0, 212, 170, 0.15);
            border-right: 3px solid #00D4AA;
        }
        
        /* Toast notification */
        .toast {
            animation: slideIn 0.3s ease;
        }
        
        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        /* Stat card pulse */
        .pulse-dot {
            animation: pulse 2s infinite;
        }
        
        @keyframes pulse {
            0%, 100% { opacity: 1; }
            50% { opacity: 0.5; }
        }
        
        /* Progress bar animation */
        .progress-bar {
            transition: width 1s ease-out;
        }
        
        /* Scrollbar styling */
        ::-webkit-scrollbar {
            width: 6px;
        }
        
        ::-webkit-scrollbar-track {
            background: #f1f1f1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb {
            background: #c1c1c1;
            border-radius: 3px;
        }
        
        ::-webkit-scrollbar-thumb:hover {
            background: #a8a8a8;
        }
        
        /* Status badge colors */
        .badge-success { background: rgba(0, 230, 118, 0.15); color: #00C853; }
        .badge-warning { background: rgba(255, 193, 7, 0.15); color: #FF9800; }
        .badge-error { background: rgba(244, 67, 54, 0.15); color: #F44336; }
        .badge-info { background: rgba(0, 102, 255, 0.15); color: #0066FF; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    
    <!-- Toast Container -->
    <div id="toast-container" class="fixed top-4 left-4 z-50 flex flex-col gap-2"></div>
    
    <div class="flex min-h-screen">
        
        <!-- Sidebar -->
        <aside class="sidebar w-64 bg-white shadow-lg fixed h-full z-40">
            <!-- Logo -->
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 gradient-primary rounded-xl flex items-center justify-center">
                        <i data-lucide="message-square" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-dark">ChatBot Pro</h1>
                        <p class="text-xs text-gray-500">× ×™×”×•×œ ×‘×•×˜ ×•×•××˜×¡××¤</p>
                    </div>
                </div>
            </div>
            
            <!-- Navigation -->
            <nav class="p-4">
                <ul class="space-y-1">
                    <li>
                        <a href="dashboard.html" class="sidebar-item active flex items-center gap-3 px-4 py-3 rounded-lg text-dark">
                            <i data-lucide="layout-dashboard" class="w-5 h-5"></i>
                            <span>×“×©×‘×•×¨×“</span>
                        </a>
                    </li>
                    <li>
                        <a href="conversations.html" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:text-dark">
                            <i data-lucide="message-circle" class="w-5 h-5"></i>
                            <span>×©×™×—×•×ª</span>
                            <span class="mr-auto bg-primary text-white text-xs px-2 py-0.5 rounded-full" id="unread-badge">3</span>
                        </a>
                    </li>
                    <li>
                        <a href="knowledge.html" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:text-dark">
                            <i data-lucide="book-open" class="w-5 h-5"></i>
                            <span>×××’×¨ ××™×“×¢</span>
                        </a>
                    </li>
                    <li>
                        <a href="appointments.html" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:text-dark">
                            <i data-lucide="calendar" class="w-5 h-5"></i>
                            <span>×¤×’×™×©×•×ª</span>
                        </a>
                    </li>
                    <li>
                        <a href="settings.html" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:text-dark">
                            <i data-lucide="settings" class="w-5 h-5"></i>
                            <span>×”×’×“×¨×•×ª</span>
                        </a>
                    </li>
                </ul>
            </nav>
            
            <!-- WhatsApp Status -->
            <div class="absolute bottom-0 w-full p-4 border-t border-gray-100">
                <div class="glass rounded-xl p-3">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 bg-success rounded-full pulse-dot"></div>
                        <div>
                            <p class="text-sm font-medium text-dark">×•×•××˜×¡××¤ ××—×•×‘×¨</p>
                            <p class="text-xs text-gray-500" id="whatsapp-number">052-1234567</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 mr-64 p-8">
            
            <!-- Header -->
            <header class="flex items-center justify-between mb-8 opacity-0" id="header">
                <div>
                    <h2 class="text-2xl font-bold text-dark">×©×œ×•×, <span id="owner-name">×™×©×¨××œ</span> ğŸ‘‹</h2>
                    <p class="text-gray-500">×”× ×” ×¡×™×›×•× ×”×¤×¢×™×œ×•×ª ×©×œ ×”×‘×•×˜ ×©×œ×š</p>
                </div>
                <div class="flex items-center gap-4">
                    <!-- Notifications -->
                    <button class="relative p-2 rounded-xl hover:bg-white hover:shadow-md transition-all">
                        <i data-lucide="bell" class="w-5 h-5 text-gray-600"></i>
                        <span class="absolute top-1 right-1 w-2 h-2 bg-red-500 rounded-full"></span>
                    </button>
                    <!-- Profile -->
                    <div class="flex items-center gap-3 glass px-4 py-2 rounded-xl">
                        <div class="w-8 h-8 gradient-secondary rounded-full flex items-center justify-center">
                            <span class="text-white text-sm font-bold" id="user-initials">×™×™</span>
                        </div>
                        <span class="text-sm font-medium text-dark" id="business-name">×™××›×˜×•×ª ×¤×œ×•×¡</span>
                    </div>
                </div>
            </header>
            
            <!-- Stats Cards -->
            <section class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-8" id="stats-section">
                
                <!-- Total Conversations -->
                <div class="card-hover glass rounded-2xl p-6 opacity-0 stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 gradient-primary rounded-xl flex items-center justify-center">
                            <i data-lucide="message-square" class="w-6 h-6 text-white"></i>
                        </div>
                        <span class="badge-success text-xs px-2 py-1 rounded-full">+12%</span>
                    </div>
                    <p class="text-3xl font-bold text-dark" id="total-conversations">--</p>
                    <p class="text-sm text-gray-500">×¡×”"×› ×©×™×—×•×ª</p>
                </div>
                
                <!-- Answered -->
                <div class="card-hover glass rounded-2xl p-6 opacity-0 stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-green-500 rounded-xl flex items-center justify-center">
                            <i data-lucide="check-circle" class="w-6 h-6 text-white"></i>
                        </div>
                        <span class="badge-success text-xs px-2 py-1 rounded-full" id="answer-rate">--%</span>
                    </div>
                    <p class="text-3xl font-bold text-dark" id="total-answered">--</p>
                    <p class="text-sm text-gray-500">× ×¢× ×• ××•×˜×•××˜×™×ª</p>
                </div>
                
                <!-- Pending Review -->
                <div class="card-hover glass rounded-2xl p-6 opacity-0 stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 bg-orange-500 rounded-xl flex items-center justify-center">
                            <i data-lucide="alert-circle" class="w-6 h-6 text-white"></i>
                        </div>
                        <span class="badge-warning text-xs px-2 py-1 rounded-full">×××ª×™×Ÿ</span>
                    </div>
                    <p class="text-3xl font-bold text-dark" id="pending-review">--</p>
                    <p class="text-sm text-gray-500">×××ª×™× ×™× ×œ××¢× ×”</p>
                </div>
                
                <!-- Appointments -->
                <div class="card-hover glass rounded-2xl p-6 opacity-0 stat-card">
                    <div class="flex items-center justify-between mb-4">
                        <div class="w-12 h-12 gradient-secondary rounded-xl flex items-center justify-center">
                            <i data-lucide="calendar-check" class="w-6 h-6 text-white"></i>
                        </div>
                        <span class="badge-info text-xs px-2 py-1 rounded-full">×”×™×•×</span>
                    </div>
                    <p class="text-3xl font-bold text-dark" id="today-appointments">--</p>
                    <p class="text-sm text-gray-500">×¤×’×™×©×•×ª ×”×™×•×</p>
                </div>
                
            </section>
            
            <!-- Charts & Recent Activity -->
            <section class="grid grid-cols-1 lg:grid-cols-3 gap-6 mb-8">
                
                <!-- Response Rate Chart -->
                <div class="lg:col-span-2 glass rounded-2xl p-6 opacity-0" id="chart-card">
                    <div class="flex items-center justify-between mb-6">
                        <h3 class="text-lg font-bold text-dark">××—×•×– ××¢× ×” ××•×˜×•××˜×™</h3>
                        <select class="text-sm bg-gray-50 border-0 rounded-lg px-3 py-2">
                            <option>7 ×™××™× ××—×¨×•× ×™×</option>
                            <option>30 ×™××™× ××—×¨×•× ×™×</option>
                            <option>90 ×™××™× ××—×¨×•× ×™×</option>
                        </select>
                    </div>
                    
                    <!-- Simple Chart (placeholder - in production use Chart.js) -->
                    <div class="h-48 flex items-end justify-between gap-2 px-4">
                        <div class="flex-1 flex flex-col items-center">
                            <div class="w-full bg-primary rounded-t-lg" style="height: 75%"></div>
                            <span class="text-xs text-gray-500 mt-2">×</span>
                        </div>
                        <div class="flex-1 flex flex-col items-center">
                            <div class="w-full bg-primary rounded-t-lg" style="height: 85%"></div>
                            <span class="text-xs text-gray-500 mt-2">×‘</span>
                        </div>
                        <div class="flex-1 flex flex-col items-center">
                            <div class="w-full bg-primary rounded-t-lg" style="height: 60%"></div>
                            <span class="text-xs text-gray-500 mt-2">×’</span>
                        </div>
                        <div class="flex-1 flex flex-col items-center">
                            <div class="w-full bg-primary rounded-t-lg" style="height: 90%"></div>
                            <span class="text-xs text-gray-500 mt-2">×“</span>
                        </div>
                        <div class="flex-1 flex flex-col items-center">
                            <div class="w-full bg-primary rounded-t-lg" style="height: 70%"></div>
                            <span class="text-xs text-gray-500 mt-2">×”</span>
                        </div>
                        <div class="flex-1 flex flex-col items-center">
                            <div class="w-full bg-primary rounded-t-lg" style="height: 45%"></div>
                            <span class="text-xs text-gray-500 mt-2">×•</span>
                        </div>
                        <div class="flex-1 flex flex-col items-center">
                            <div class="w-full bg-gray-200 rounded-t-lg" style="height: 10%"></div>
                            <span class="text-xs text-gray-500 mt-2">×©</span>
                        </div>
                    </div>
                    
                    <div class="flex items-center justify-center gap-6 mt-6">
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-primary rounded-full"></div>
                            <span class="text-sm text-gray-600">× ×¢× ×• ××•×˜×•××˜×™×ª</span>
                        </div>
                        <div class="flex items-center gap-2">
                            <div class="w-3 h-3 bg-gray-200 rounded-full"></div>
                            <span class="text-sm text-gray-600">×œ×œ× ×ª×©×•×‘×”</span>
                        </div>
                    </div>
                </div>
                
                <!-- Quick Actions -->
                <div class="glass rounded-2xl p-6 opacity-0" id="actions-card">
                    <h3 class="text-lg font-bold text-dark mb-6">×¤×¢×•×œ×•×ª ××”×™×¨×•×ª</h3>
                    
                    <div class="space-y-3">
                        <a href="knowledge.html" class="ripple block w-full gradient-primary text-white text-center py-3 rounded-xl font-medium hover:shadow-lg transition-shadow">
                            <i data-lucide="plus" class="w-4 h-4 inline ml-2"></i>
                            ×”×•×¡×£ ×©××œ×” ×œ×××’×¨
                        </a>
                        
                        <a href="conversations.html?filter=no_answer" class="ripple block w-full bg-orange-500 text-white text-center py-3 rounded-xl font-medium hover:shadow-lg transition-shadow">
                            <i data-lucide="message-circle" class="w-4 h-4 inline ml-2"></i>
                            ×¦×¤×” ×‘×©××œ×•×ª ×œ×œ× ××¢× ×”
                        </a>
                        
                        <a href="settings.html" class="ripple block w-full bg-gray-100 text-dark text-center py-3 rounded-xl font-medium hover:bg-gray-200 transition-colors">
                            <i data-lucide="settings" class="w-4 h-4 inline ml-2"></i>
                            ×”×’×“×¨×•×ª ×”×‘×•×˜
                        </a>
                    </div>
                    
                    <!-- Bot Status -->
                    <div class="mt-6 p-4 bg-green-50 rounded-xl">
                        <div class="flex items-center gap-3">
                            <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                                <i data-lucide="bot" class="w-5 h-5 text-white"></i>
                            </div>
                            <div>
                                <p class="font-medium text-green-800">×”×‘×•×˜ ×¤×¢×™×œ</p>
                                <p class="text-sm text-green-600">××’×™×‘ ×œ×›×œ ×”×•×“×¢×” ×—×“×©×”</p>
                            </div>
                        </div>
                    </div>
                </div>
                
            </section>
            
            <!-- Recent Conversations -->
            <section class="glass rounded-2xl p-6 opacity-0" id="recent-section">
                <div class="flex items-center justify-between mb-6">
                    <h3 class="text-lg font-bold text-dark">×©×™×—×•×ª ××—×¨×•× ×•×ª</h3>
                    <a href="conversations.html" class="text-primary hover:text-primary-dark text-sm font-medium flex items-center gap-1">
                        ×¦×¤×” ×‘×›×œ ×”×©×™×—×•×ª
                        <i data-lucide="arrow-left" class="w-4 h-4"></i>
                    </a>
                </div>
                
                <!-- Conversations List -->
                <div class="space-y-4" id="conversations-list">
                    <!-- Loading Skeleton -->
                    <div class="conversation-skeleton">
                        <div class="flex items-center gap-4 p-4 border border-gray-100 rounded-xl">
                            <div class="skeleton w-12 h-12 rounded-full"></div>
                            <div class="flex-1">
                                <div class="skeleton h-4 w-32 mb-2 rounded"></div>
                                <div class="skeleton h-3 w-full rounded"></div>
                            </div>
                            <div class="skeleton h-6 w-20 rounded-full"></div>
                        </div>
                    </div>
                    <div class="conversation-skeleton">
                        <div class="flex items-center gap-4 p-4 border border-gray-100 rounded-xl">
                            <div class="skeleton w-12 h-12 rounded-full"></div>
                            <div class="flex-1">
                                <div class="skeleton h-4 w-32 mb-2 rounded"></div>
                                <div class="skeleton h-3 w-full rounded"></div>
                            </div>
                            <div class="skeleton h-6 w-20 rounded-full"></div>
                        </div>
                    </div>
                    <div class="conversation-skeleton">
                        <div class="flex items-center gap-4 p-4 border border-gray-100 rounded-xl">
                            <div class="skeleton w-12 h-12 rounded-full"></div>
                            <div class="flex-1">
                                <div class="skeleton h-4 w-32 mb-2 rounded"></div>
                                <div class="skeleton h-3 w-full rounded"></div>
                            </div>
                            <div class="skeleton h-6 w-20 rounded-full"></div>
                        </div>
                    </div>
                </div>
                
                <!-- Empty State (hidden by default) -->
                <div class="hidden text-center py-12" id="empty-state">
                    <div class="w-20 h-20 mx-auto mb-4 bg-gray-100 rounded-full flex items-center justify-center">
                        <i data-lucide="message-square-off" class="w-10 h-10 text-gray-400"></i>
                    </div>
                    <h4 class="text-lg font-medium text-dark mb-2">×¢×“×™×™×Ÿ ××™×Ÿ ×©×™×—×•×ª</h4>
                    <p class="text-gray-500 mb-4">×‘×¨×’×¢ ×©×œ×§×•×—×•×ª ×™×©×œ×—×• ×”×•×“×¢×•×ª, ×”×Ÿ ×™×•×¤×™×¢×• ×›××Ÿ</p>
                </div>
                
            </section>
            
        </main>
    </div>
    
    <!-- Supabase Client -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    
    <script>
        // ============================================
        // Configuration
        // ============================================
        const SUPABASE_URL = 'YOUR_SUPABASE_URL';
        const SUPABASE_ANON_KEY = 'YOUR_SUPABASE_ANON_KEY';
        
        // For demo - replace with actual business ID from URL or auth
        const BUSINESS_ID = new URLSearchParams(window.location.search).get('business_id') || 'demo';
        
        // Initialize Supabase
        const supabase = window.supabase.createClient(SUPABASE_URL, SUPABASE_ANON_KEY);
        
        // ============================================
        // Initialize Lucide Icons
        // ============================================
        lucide.createIcons();
        
        // ============================================
        // GSAP Animations
        // ============================================
        function initAnimations() {
            // Header animation
            gsap.to('#header', {
                opacity: 1,
                y: 0,
                duration: 0.6,
                ease: 'power2.out'
            });
            
            // Stats cards staggered animation
            gsap.to('.stat-card', {
                opacity: 1,
                y: 0,
                duration: 0.5,
                stagger: 0.1,
                ease: 'power2.out',
                delay: 0.3
            });
            
            // Chart card
            gsap.to('#chart-card', {
                opacity: 1,
                y: 0,
                duration: 0.5,
                ease: 'power2.out',
                delay: 0.7
            });
            
            // Actions card
            gsap.to('#actions-card', {
                opacity: 1,
                y: 0,
                duration: 0.5,
                ease: 'power2.out',
                delay: 0.8
            });
            
            // Recent section
            gsap.to('#recent-section', {
                opacity: 1,
                y: 0,
                duration: 0.5,
                ease: 'power2.out',
                delay: 0.9
            });
        }
        
        // Set initial states
        gsap.set('#header', { opacity: 0, y: -20 });
        gsap.set('.stat-card', { opacity: 0, y: 20 });
        gsap.set('#chart-card', { opacity: 0, y: 20 });
        gsap.set('#actions-card', { opacity: 0, y: 20 });
        gsap.set('#recent-section', { opacity: 0, y: 20 });
        
        // ============================================
        // Toast Notifications
        // ============================================
        function showToast(message, type = 'success') {
            const container = document.getElementById('toast-container');
            const toast = document.createElement('div');
            
            const bgColor = type === 'success' ? 'bg-green-500' : 
                           type === 'error' ? 'bg-red-500' : 
                           type === 'warning' ? 'bg-orange-500' : 'bg-blue-500';
            
            toast.className = `toast ${bgColor} text-white px-6 py-3 rounded-xl shadow-lg flex items-center gap-3`;
            toast.innerHTML = `
                <i data-lucide="${type === 'success' ? 'check-circle' : type === 'error' ? 'x-circle' : 'alert-circle'}" class="w-5 h-5"></i>
                <span>${message}</span>
            `;
            
            container.appendChild(toast);
            lucide.createIcons();
            
            // Remove after 3 seconds
            setTimeout(() => {
                toast.style.opacity = '0';
                toast.style.transform = 'translateX(100%)';
                setTimeout(() => toast.remove(), 300);
            }, 3000);
        }
        
        // ============================================
        // Data Loading Functions
        // ============================================
        async function loadBusinessData() {
            try {
                // For demo mode, use mock data
                if (BUSINESS_ID === 'demo') {
                    return {
                        business_name: '×™××›×˜×•×ª ×¤×œ×•×¡',
                        owner_name: '×™×©×¨××œ',
                        whatsapp_number: '052-1234567',
                        total_conversations: 156,
                        total_answered: 142
                    };
                }
                
                const { data, error } = await supabase
                    .from('businesses')
                    .select('*')
                    .eq('id', BUSINESS_ID)
                    .single();
                
                if (error) throw error;
                return data;
                
            } catch (error) {
                console.error('Error loading business:', error);
                showToast('×©×’×™××” ×‘×˜×¢×™× ×ª × ×ª×•× ×™ ×”×¢×¡×§', 'error');
                return null;
            }
        }
        
        async function loadStats() {
            try {
                if (BUSINESS_ID === 'demo') {
                    return {
                        total: 156,
                        answered: 142,
                        pending: 8,
                        appointments: 3
                    };
                }
                
                // Get total conversations
                const { count: total } = await supabase
                    .from('conversations')
                    .select('*', { count: 'exact', head: true })
                    .eq('business_id', BUSINESS_ID);
                
                // Get answered
                const { count: answered } = await supabase
                    .from('conversations')
                    .select('*', { count: 'exact', head: true })
                    .eq('business_id', BUSINESS_ID)
                    .eq('response_type', 'answered');
                
                // Get pending (no answer)
                const { count: pending } = await supabase
                    .from('conversations')
                    .select('*', { count: 'exact', head: true })
                    .eq('business_id', BUSINESS_ID)
                    .eq('response_type', 'no_answer')
                    .eq('needs_followup', true);
                
                // Get today's appointments
                const today = new Date().toISOString().split('T')[0];
                const { count: appointments } = await supabase
                    .from('appointments')
                    .select('*', { count: 'exact', head: true })
                    .eq('business_id', BUSINESS_ID)
                    .gte('scheduled_time', today)
                    .lt('scheduled_time', today + 'T23:59:59');
                
                return { total, answered, pending, appointments };
                
            } catch (error) {
                console.error('Error loading stats:', error);
                return { total: 0, answered: 0, pending: 0, appointments: 0 };
            }
        }
        
        async function loadRecentConversations() {
            try {
                if (BUSINESS_ID === 'demo') {
                    return [
                        {
                            id: '1',
                            customer_phone: '052-9876543',
                            customer_name: '×“× ×™ ×›×”×Ÿ',
                            message: '×›××” ×¢×•×œ×” ×œ×”×©×›×™×¨ ×™××›×˜×” ×œ-10 ×× ×©×™×?',
                            bot_response: '×”××—×™×¨×™× ××©×ª× ×™× ×œ×¤×™ ×’×•×“×œ ×”×™××›×˜×”...',
                            response_type: 'answered',
                            timestamp: new Date(Date.now() - 5 * 60000).toISOString()
                        },
                        {
                            id: '2',
                            customer_phone: '054-1234567',
                            customer_name: '×©×¨×” ×œ×•×™',
                            message: '×”×× ×™×© ×œ×›× ×™××›×˜×” ×¢× ×’\'×§×•×–×™?',
                            bot_response: null,
                            response_type: 'no_answer',
                            timestamp: new Date(Date.now() - 30 * 60000).toISOString()
                        },
                        {
                            id: '3',
                            customer_phone: '050-5555555',
                            customer_name: null,
                            message: '××ª×™ ××ª× ×¤×ª×•×—×™×?',
                            bot_response: '×× ×—× ×• ×¤×¢×™×œ×™× ×™××™× ×-×”...',
                            response_type: 'answered',
                            timestamp: new Date(Date.now() - 2 * 3600000).toISOString()
                        }
                    ];
                }
                
                const { data, error } = await supabase
                    .from('conversations')
                    .select('*')
                    .eq('business_id', BUSINESS_ID)
                    .order('timestamp', { ascending: false })
                    .limit(5);
                
                if (error) throw error;
                return data;
                
            } catch (error) {
                console.error('Error loading conversations:', error);
                return [];
            }
        }
        
        // ============================================
        // Render Functions
        // ============================================
        function renderConversations(conversations) {
            const container = document.getElementById('conversations-list');
            const emptyState = document.getElementById('empty-state');
            
            // Remove skeletons
            container.querySelectorAll('.conversation-skeleton').forEach(el => el.remove());
            
            if (!conversations || conversations.length === 0) {
                emptyState.classList.remove('hidden');
                return;
            }
            
            conversations.forEach((conv, index) => {
                const timeAgo = getTimeAgo(conv.timestamp);
                const statusBadge = getStatusBadge(conv.response_type);
                const displayName = conv.customer_name || formatPhone(conv.customer_phone);
                
                const card = document.createElement('div');
                card.className = 'card-hover flex items-center gap-4 p-4 border border-gray-100 rounded-xl cursor-pointer';
                card.style.opacity = '0';
                card.innerHTML = `
                    <div class="w-12 h-12 gradient-secondary rounded-full flex items-center justify-center flex-shrink-0">
                        <span class="text-white font-bold">${getInitials(displayName)}</span>
                    </div>
                    <div class="flex-1 min-w-0">
                        <div class="flex items-center gap-2 mb-1">
                            <h4 class="font-medium text-dark">${displayName}</h4>
                            <span class="text-xs text-gray-400">${timeAgo}</span>
                        </div>
                        <p class="text-sm text-gray-600 truncate">${conv.message}</p>
                    </div>
                    ${statusBadge}
                `;
                
                card.onclick = () => {
                    window.location.href = `conversations.html?id=${conv.id}`;
                };
                
                container.appendChild(card);
                
                // Animate in
                gsap.to(card, {
                    opacity: 1,
                    y: 0,
                    duration: 0.3,
                    delay: index * 0.1,
                    ease: 'power2.out'
                });
            });
        }
        
        function getStatusBadge(type) {
            switch (type) {
                case 'answered':
                    return '<span class="badge-success text-xs px-3 py-1 rounded-full flex-shrink-0">âœ“ × ×¢× ×”</span>';
                case 'no_answer':
                    return '<span class="badge-warning text-xs px-3 py-1 rounded-full flex-shrink-0">â³ ×××ª×™×Ÿ</span>';
                case 'scheduling':
                    return '<span class="badge-info text-xs px-3 py-1 rounded-full flex-shrink-0">ğŸ“… ×¤×’×™×©×”</span>';
                default:
                    return '<span class="badge-info text-xs px-3 py-1 rounded-full flex-shrink-0">ğŸ’¬</span>';
            }
        }
        
        function getTimeAgo(timestamp) {
            const now = new Date();
            const then = new Date(timestamp);
            const diff = Math.floor((now - then) / 1000);
            
            if (diff < 60) return '×¢×›×©×™×•';
            if (diff < 3600) return `×œ×¤× ×™ ${Math.floor(diff / 60)} ×“×§×•×ª`;
            if (diff < 86400) return `×œ×¤× ×™ ${Math.floor(diff / 3600)} ×©×¢×•×ª`;
            return `×œ×¤× ×™ ${Math.floor(diff / 86400)} ×™××™×`;
        }
        
        function getInitials(name) {
            if (!name) return '?';
            const parts = name.split(' ');
            if (parts.length >= 2) {
                return parts[0][0] + parts[1][0];
            }
            return name.substring(0, 2);
        }
        
        function formatPhone(phone) {
            if (!phone) return '×œ× ×™×“×•×¢';
            // Format: 052-123-4567
            return phone.replace(/(\d{3})(\d{3})(\d{4})/, '$1-$2-$3');
        }
        
        // ============================================
        // Initialize Dashboard
        // ============================================
        async function init() {
            // Load business data
            const business = await loadBusinessData();
            if (business) {
                document.getElementById('owner-name').textContent = business.owner_name;
                document.getElementById('business-name').textContent = business.business_name;
                document.getElementById('user-initials').textContent = getInitials(business.owner_name);
                document.getElementById('whatsapp-number').textContent = business.whatsapp_number || '×œ× ××—×•×‘×¨';
            }
            
            // Load stats
            const stats = await loadStats();
            document.getElementById('total-conversations').textContent = stats.total.toLocaleString();
            document.getElementById('total-answered').textContent = stats.answered.toLocaleString();
            document.getElementById('pending-review').textContent = stats.pending.toLocaleString();
            document.getElementById('today-appointments').textContent = stats.appointments.toLocaleString();
            
            // Calculate answer rate
            const answerRate = stats.total > 0 ? Math.round((stats.answered / stats.total) * 100) : 0;
            document.getElementById('answer-rate').textContent = `${answerRate}%`;
            
            // Update unread badge
            document.getElementById('unread-badge').textContent = stats.pending;
            
            // Load recent conversations
            const conversations = await loadRecentConversations();
            renderConversations(conversations);
            
            // Start animations
            initAnimations();
            
            // Show welcome toast
            setTimeout(() => {
                showToast('×‘×¨×•×š ×”×‘× ×œ×“×©×‘×•×¨×“! ğŸ‰', 'success');
            }, 1500);
        }
        
        // Start!
        document.addEventListener('DOMContentLoaded', init);
        
        // ============================================
        // Real-time Subscription (for production)
        // ============================================
        if (BUSINESS_ID !== 'demo') {
            supabase
                .channel('conversations')
                .on('postgres_changes', 
                    { 
                        event: 'INSERT', 
                        schema: 'public', 
                        table: 'conversations',
                        filter: `business_id=eq.${BUSINESS_ID}`
                    }, 
                    (payload) => {
                        console.log('New conversation:', payload);
                        showToast('×”×•×“×¢×” ×—×“×©×” ×”×ª×§×‘×œ×”! ğŸ“©', 'info');
                        // Reload conversations
                        loadRecentConversations().then(renderConversations);
                    }
                )
                .subscribe();
        }
    </script>
    
</body>
</html>
