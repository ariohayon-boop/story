<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ChatBot Pro - ×”×’×“×¨×•×ª</title>
    
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Heebo:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/gsap/3.12.2/gsap.min.js"></script>
    <script src="https://unpkg.com/lucide@latest/dist/umd/lucide.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script>
    <script src="js/config.js"></script>
    
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#00D4AA',
                        'primary-dark': '#00A080',
                        secondary: '#0066FF',
                        dark: '#1A1A2E',
                        success: '#00E676',
                    }
                }
            }
        }
    </script>
    
    <style>
        * { font-family: 'Heebo', sans-serif; }
        .glass { background: rgba(255, 255, 255, 0.7); backdrop-filter: blur(10px); border: 1px solid rgba(255, 255, 255, 0.3); }
        .gradient-bg { background: linear-gradient(135deg, #f5f7fa 0%, #e4e8ec 100%); }
        .gradient-primary { background: linear-gradient(135deg, #00D4AA 0%, #00A080 100%); }
        .sidebar-item { transition: all 0.2s ease; }
        .sidebar-item:hover { background: rgba(0, 212, 170, 0.1); }
        .sidebar-item.active { background: rgba(0, 212, 170, 0.15); border-right: 3px solid #00D4AA; }
        @keyframes slideIn { from { transform: translateX(100%); opacity: 0; } to { transform: translateX(0); opacity: 1; } }
        .toast { animation: slideIn 0.3s ease; }
        .pulse-dot { animation: pulse 2s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.5; } }
        .toggle-switch { position: relative; width: 48px; height: 24px; background: #e5e7eb; border-radius: 12px; cursor: pointer; transition: background 0.3s; }
        .toggle-switch.active { background: #00D4AA; }
        .toggle-switch::after { content: ''; position: absolute; top: 2px; left: 2px; width: 20px; height: 20px; background: white; border-radius: 50%; transition: transform 0.3s; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .toggle-switch.active::after { transform: translateX(24px); }
        ::-webkit-scrollbar { width: 6px; }
        ::-webkit-scrollbar-track { background: #f1f1f1; border-radius: 3px; }
        ::-webkit-scrollbar-thumb { background: #c1c1c1; border-radius: 3px; }
    </style>
</head>
<body class="gradient-bg min-h-screen">
    
    <div id="toast-container" class="fixed top-4 left-4 z-50 flex flex-col gap-2"></div>
    
    <div class="flex min-h-screen">
        
        <!-- Sidebar -->
        <aside class="sidebar w-64 bg-white shadow-lg fixed h-full z-40">
            <div class="p-6 border-b border-gray-100">
                <div class="flex items-center gap-3">
                    <div class="w-10 h-10 gradient-primary rounded-xl flex items-center justify-center">
                        <i data-lucide="message-square" class="w-5 h-5 text-white"></i>
                    </div>
                    <div>
                        <h1 class="text-lg font-bold text-dark">ChatBot Pro</h1>
                        <p class="text-xs text-gray-500">× ×™×”×•×œ ×‘×•×˜ ×•×•××˜×¡××¤</p>
                    </div>
                </div>
            </div>
            
            <nav class="p-4">
                <ul class="space-y-1">
                    <li><a href="index.html" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:text-dark"><i data-lucide="layout-dashboard" class="w-5 h-5"></i><span>×“×©×‘×•×¨×“</span></a></li>
                    <li><a href="conversations.html" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:text-dark"><i data-lucide="message-circle" class="w-5 h-5"></i><span>×©×™×—×•×ª</span></a></li>
                    <li><a href="knowledge.html" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:text-dark"><i data-lucide="book-open" class="w-5 h-5"></i><span>×××’×¨ ××™×“×¢</span></a></li>
                    <li><a href="appointments.html" class="sidebar-item flex items-center gap-3 px-4 py-3 rounded-lg text-gray-600 hover:text-dark"><i data-lucide="calendar" class="w-5 h-5"></i><span>×¤×’×™×©×•×ª</span></a></li>
                    <li><a href="settings.html" class="sidebar-item active flex items-center gap-3 px-4 py-3 rounded-lg text-dark"><i data-lucide="settings" class="w-5 h-5"></i><span>×”×’×“×¨×•×ª</span></a></li>
                </ul>
            </nav>
            
            <div class="absolute bottom-0 w-full p-4 border-t border-gray-100">
                <div class="glass rounded-xl p-3">
                    <div class="flex items-center gap-3">
                        <div class="w-3 h-3 bg-success rounded-full pulse-dot"></div>
                        <div>
                            <p class="text-sm font-medium text-dark">×•×•××˜×¡××¤ ××—×•×‘×¨</p>
                            <p class="text-xs text-gray-500">××¦×‘ ×“××•</p>
                        </div>
                    </div>
                </div>
            </div>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 mr-64 p-8">
            
            <!-- Header -->
            <header class="mb-8 opacity-0" id="header">
                <h2 class="text-2xl font-bold text-dark">×”×’×“×¨×•×ª âš™ï¸</h2>
                <p class="text-gray-500">× ×”×œ ××ª ×”×’×“×¨×•×ª ×”×¢×¡×§ ×•×”×‘×•×˜</p>
            </header>
            
            <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
                
                <!-- Main Settings -->
                <div class="lg:col-span-2 space-y-6">
                    
                    <!-- Business Info -->
                    <section class="glass rounded-2xl p-6 opacity-0" id="business-section">
                        <h3 class="text-lg font-bold text-dark mb-6 flex items-center gap-2">
                            <i data-lucide="building" class="w-5 h-5 text-primary"></i>
                            ×¤×¨×˜×™ ×”×¢×¡×§
                        </h3>
                        
                        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">×©× ×”×¢×¡×§</label>
                                <input type="text" id="business-name" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent" value="×™××›×˜×•×ª ×¤×œ×•×¡">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">×©× ×‘×¢×œ ×”×¢×¡×§</label>
                                <input type="text" id="owner-name" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent" value="×™×©×¨××œ ×™×©×¨××œ×™">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">××™××™×™×œ</label>
                                <input type="email" id="email" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent" value="demo@chatbot-pro.com">
                            </div>
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">×˜×œ×¤×•×Ÿ</label>
                                <input type="tel" id="phone" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent" value="050-1234567">
                            </div>
                        </div>
                    </section>
                    
                    <!-- Bot Settings -->
                    <section class="glass rounded-2xl p-6 opacity-0" id="bot-section">
                        <h3 class="text-lg font-bold text-dark mb-6 flex items-center gap-2">
                            <i data-lucide="bot" class="w-5 h-5 text-primary"></i>
                            ×”×’×“×¨×•×ª ×”×‘×•×˜
                        </h3>
                        
                        <div class="space-y-4">
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">×©× ×”×‘×•×˜</label>
                                <input type="text" id="bot-name" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent" value="××™×›×œ - ×”×¢×•×–×¨×ª ×”×•×™×¨×˜×•××œ×™×ª">
                                <p class="text-xs text-gray-500 mt-1">×”×©× ×©×”×‘×•×˜ ×™×¦×™×’ ×œ×œ×§×•×—×•×ª</p>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">×¡×’× ×•×Ÿ ×ª×§×©×•×¨×ª</label>
                                <select id="bot-style" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent">
                                    <option value="formal">ğŸ© ×¨×©××™ ×•××§×¦×•×¢×™</option>
                                    <option value="friendly" selected>ğŸ˜Š ×™×“×™×“×•×ª×™ ×•× ×¢×™×</option>
                                    <option value="casual">ğŸ¤™ ×§×–'×•××œ×™ ×•×—×‘×¨×™</option>
                                </select>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">×”×•×“×¢×ª ×¤×ª×™×—×”</label>
                                <textarea id="welcome-message" rows="3" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent resize-none">×©×œ×•×! ğŸ‘‹ ×× ×™ ××™×›×œ ××™××›×˜×•×ª ×¤×œ×•×¡. ××™×š ××•×›×œ ×œ×¢×–×•×¨ ×œ×š ×”×™×•×?</textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">×”×•×“×¢×” ×›×©××™×Ÿ ×ª×©×•×‘×”</label>
                                <textarea id="no-answer-message" rows="3" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent resize-none">×©××œ×” ××¢×•×œ×”! ğŸ¤” ××¢×‘×™×¨ ××•×ª×” ×œ×× ×”×œ ×•×”×•× ×™×—×–×•×¨ ××œ×™×š ×‘×”×§×“×.</textarea>
                            </div>
                            
                            <div>
                                <label class="block text-sm font-medium text-dark mb-2">×”×•×“×¢×” ××—×•×¥ ×œ×©×¢×•×ª ×¤×¢×™×œ×•×ª</label>
                                <textarea id="out-of-hours-message" rows="3" class="w-full px-4 py-3 bg-gray-50 border border-gray-200 rounded-xl focus:ring-2 focus:ring-primary focus:border-transparent resize-none">×ª×•×“×” ×¢×œ ×”×¤× ×™×™×”! ğŸ™ ×× ×—× ×• ×›×¨×’×¢ ×œ× ×–××™× ×™×, ××‘×œ × ×—×–×•×¨ ××œ×™×š ×‘×©×¢×•×ª ×”×¤×¢×™×œ×•×ª.</textarea>
                            </div>
                        </div>
                    </section>
                    
                    <!-- Working Hours -->
                    <section class="glass rounded-2xl p-6 opacity-0" id="hours-section">
                        <h3 class="text-lg font-bold text-dark mb-6 flex items-center gap-2">
                            <i data-lucide="clock" class="w-5 h-5 text-primary"></i>
                            ×©×¢×•×ª ×¤×¢×™×œ×•×ª
                        </h3>
                        
                        <div class="space-y-3" id="working-hours">
                            <!-- Will be populated by JS -->
                        </div>
                    </section>
                    
                    <!-- Save Button -->
                    <button onclick="saveSettings()" class="w-full gradient-primary text-white py-4 rounded-xl font-medium hover:shadow-lg transition-shadow flex items-center justify-center gap-2">
                        <i data-lucide="save" class="w-5 h-5"></i>
                        ×©××•×¨ ×”×’×“×¨×•×ª
                    </button>
                    
                </div>
                
                <!-- Side Panel -->
                <div class="space-y-6">
                    
                    <!-- WhatsApp Connection -->
                    <section class="glass rounded-2xl p-6 opacity-0" id="whatsapp-section">
                        <h3 class="text-lg font-bold text-dark mb-4 flex items-center gap-2">
                            <i data-lucide="smartphone" class="w-5 h-5 text-green-600"></i>
                            ×—×™×‘×•×¨ WhatsApp
                        </h3>
                        
                        <div class="bg-green-50 rounded-xl p-4 mb-4">
                            <div class="flex items-center gap-3">
                                <div class="w-10 h-10 bg-green-500 rounded-full flex items-center justify-center">
                                    <i data-lucide="check" class="w-5 h-5 text-white"></i>
                                </div>
                                <div>
                                    <p class="font-medium text-green-800">××—×•×‘×¨</p>
                                    <p class="text-sm text-green-600" id="connected-number">052-1234567</p>
                                </div>
                            </div>
                        </div>
                        
                        <button class="w-full py-3 border border-gray-200 rounded-xl text-gray-600 hover:bg-gray-50 transition-colors flex items-center justify-center gap-2">
                            <i data-lucide="refresh-cw" class="w-4 h-4"></i>
                            ×—×‘×¨ ××¡×¤×¨ ××—×¨
                        </button>
                    </section>
                    
                    <!-- Plan Info -->
                    <section class="glass rounded-2xl p-6 opacity-0" id="plan-section">
                        <h3 class="text-lg font-bold text-dark mb-4 flex items-center gap-2">
                            <i data-lucide="crown" class="w-5 h-5 text-yellow-500"></i>
                            ×”×ª×•×›× ×™×ª ×©×œ×š
                        </h3>
                        
                        <div class="bg-gradient-to-br from-primary/10 to-primary/5 rounded-xl p-4 mb-4">
                            <p class="text-2xl font-bold text-dark">Trial</p>
                            <p class="text-sm text-gray-600">×ª×§×•×¤×ª × ×™×¡×™×•×Ÿ - 14 ×™××™×</p>
                            <div class="mt-3 bg-white rounded-full h-2 overflow-hidden">
                                <div class="bg-primary h-full" style="width: 30%"></div>
                            </div>
                            <p class="text-xs text-gray-500 mt-1">× ×•×ª×¨×• 10 ×™××™×</p>
                        </div>
                        
                        <button class="w-full gradient-primary text-white py-3 rounded-xl font-medium hover:shadow-lg transition-shadow">
                            ×©×“×¨×’ ×œ×ª×•×›× ×™×ª Pro
                        </button>
                    </section>
                    
                    <!-- Danger Zone -->
                    <section class="glass rounded-2xl p-6 opacity-0 border-2 border-red-100" id="danger-section">
                        <h3 class="text-lg font-bold text-red-600 mb-4 flex items-center gap-2">
                            <i data-lucide="alert-triangle" class="w-5 h-5"></i>
                            ××–×•×¨ ××¡×•×›×Ÿ
                        </h3>
                        
                        <button class="w-full py-3 border border-red-200 rounded-xl text-red-600 hover:bg-red-50 transition-colors">
                            ××—×§ ××ª ×›×œ ×”× ×ª×•× ×™×
                        </button>
                    </section>
                    
                </div>
            </div>
            
        </main>
    </div>
    
    <script>
        // ============================================
        // State
        // ============================================
        const BUSINESS_ID = getBusinessId();
        const dayNames = {
            sunday: '×¨××©×•×Ÿ',
            monday: '×©× ×™',
            tuesday: '×©×œ×™×©×™',
            wednesday: '×¨×‘×™×¢×™',
            thursday: '×—××™×©×™',
            friday: '×©×™×©×™',
            saturday: '×©×‘×ª'
        };
        
        let settings = null;
        
        // ============================================
        // Initialize
        // ============================================
        lucide.createIcons();
        
        gsap.set('#header', { opacity: 0, y: -20 });
        gsap.set('#business-section', { opacity: 0, y: 20 });
        gsap.set('#bot-section', { opacity: 0, y: 20 });
        gsap.set('#hours-section', { opacity: 0, y: 20 });
        gsap.set('#whatsapp-section', { opacity: 0, x: 20 });
        gsap.set('#plan-section', { opacity: 0, x: 20 });
        gsap.set('#danger-section', { opacity: 0, x: 20 });
        
        function initAnimations() {
            gsap.to('#header', { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out' });
            gsap.to('#business-section', { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out', delay: 0.2 });
            gsap.to('#bot-section', { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out', delay: 0.3 });
            gsap.to('#hours-section', { opacity: 1, y: 0, duration: 0.5, ease: 'power2.out', delay: 0.4 });
            gsap.to('#whatsapp-section', { opacity: 1, x: 0, duration: 0.5, ease: 'power2.out', delay: 0.3 });
            gsap.to('#plan-section', { opacity: 1, x: 0, duration: 0.5, ease: 'power2.out', delay: 0.4 });
            gsap.to('#danger-section', { opacity: 1, x: 0, duration: 0.5, ease: 'power2.out', delay: 0.5 });
        }
        
        // ============================================
        // Load Settings
        // ============================================
        async function loadSettings() {
            if (isDemoMode()) {
                settings = DEMO_DATA.business;
            } else {
                try {
                    const db = getSupabase();
                    const { data, error } = await db
                        .from('businesses')
                        .select('*')
                        .eq('id', BUSINESS_ID)
                        .single();
                    
                    if (error) throw error;
                    settings = data;
                } catch (error) {
                    console.error('Error:', error);
                    settings = DEMO_DATA.business;
                }
            }
            
            populateForm();
            renderWorkingHours();
        }
        
        function populateForm() {
            if (!settings) return;
            
            document.getElementById('business-name').value = settings.business_name || '';
            document.getElementById('owner-name').value = settings.owner_name || '';
            document.getElementById('email').value = settings.email || '';
            document.getElementById('phone').value = settings.phone || '';
            document.getElementById('bot-name').value = settings.bot_name || '';
            document.getElementById('bot-style').value = settings.bot_style || 'friendly';
            document.getElementById('welcome-message').value = settings.welcome_message || '';
            document.getElementById('no-answer-message').value = settings.no_answer_message || '';
            document.getElementById('out-of-hours-message').value = settings.out_of_hours_message || '';
            document.getElementById('connected-number').textContent = formatPhone(settings.whatsapp_number);
        }
        
        function renderWorkingHours() {
            const container = document.getElementById('working-hours');
            const hours = settings?.working_hours || DEMO_DATA.business.working_hours;
            
            container.innerHTML = Object.entries(dayNames).map(([day, label]) => {
                const dayHours = hours[day] || { active: false, start: '09:00', end: '18:00' };
                return `
                    <div class="flex items-center gap-4 p-3 bg-gray-50 rounded-xl">
                        <div class="toggle-switch ${dayHours.active ? 'active' : ''}" onclick="toggleDay('${day}', this)" data-day="${day}"></div>
                        <span class="w-16 font-medium text-dark">${label}</span>
                        <input type="time" value="${dayHours.start}" class="px-3 py-2 bg-white border border-gray-200 rounded-lg text-sm" data-day="${day}" data-type="start" ${!dayHours.active ? 'disabled' : ''}>
                        <span class="text-gray-400">-</span>
                        <input type="time" value="${dayHours.end}" class="px-3 py-2 bg-white border border-gray-200 rounded-lg text-sm" data-day="${day}" data-type="end" ${!dayHours.active ? 'disabled' : ''}>
                    </div>
                `;
            }).join('');
        }
        
        function toggleDay(day, element) {
            element.classList.toggle('active');
            const isActive = element.classList.contains('active');
            
            document.querySelectorAll(`input[data-day="${day}"]`).forEach(input => {
                input.disabled = !isActive;
            });
        }
        
        // ============================================
        // Save Settings
        // ============================================
        async function saveSettings() {
            // Collect working hours
            const workingHours = {};
            Object.keys(dayNames).forEach(day => {
                const toggle = document.querySelector(`[data-day="${day}"].toggle-switch`);
                const startInput = document.querySelector(`input[data-day="${day}"][data-type="start"]`);
                const endInput = document.querySelector(`input[data-day="${day}"][data-type="end"]`);
                
                workingHours[day] = {
                    active: toggle?.classList.contains('active') || false,
                    start: startInput?.value || '09:00',
                    end: endInput?.value || '18:00'
                };
            });
            
            const updatedSettings = {
                business_name: document.getElementById('business-name').value,
                owner_name: document.getElementById('owner-name').value,
                email: document.getElementById('email').value,
                phone: document.getElementById('phone').value,
                bot_name: document.getElementById('bot-name').value,
                bot_style: document.getElementById('bot-style').value,
                welcome_message: document.getElementById('welcome-message').value,
                no_answer_message: document.getElementById('no-answer-message').value,
                out_of_hours_message: document.getElementById('out-of-hours-message').value,
                working_hours: workingHours
            };
            
            if (isDemoMode()) {
                showToast('×‘××¦×‘ ×“××• - ×”×”×’×“×¨×•×ª ×œ× × ×©××¨×•×ª', 'warning');
                return;
            }
            
            try {
                const db = getSupabase();
                const { error } = await db
                    .from('businesses')
                    .update(updatedSettings)
                    .eq('id', BUSINESS_ID);
                
                if (error) throw error;
                showToast('×”×”×’×“×¨×•×ª × ×©××¨×• ×‘×”×¦×œ×—×”! âœ“');
            } catch (error) {
                console.error('Error:', error);
                showToast('×©×’×™××” ×‘×©××™×¨×ª ×”×”×’×“×¨×•×ª', 'error');
            }
        }
        
        // ============================================
        // Init
        // ============================================
        document.addEventListener('DOMContentLoaded', () => {
            initAnimations();
            loadSettings();
        });
    </script>
    
</body>
</html>
